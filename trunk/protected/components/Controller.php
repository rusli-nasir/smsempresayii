<?php/** * Controller is the customized base controller class. * All controller classes for this application should extend from this base class. */class Controller extends CController {    /**     * @var string the default layout for the controller view. Defaults to '//layouts/column1',     * meaning using a single column layout. See 'protected/views/layouts/column1.php'.     */    public $layout = '//layouts/column1';    /**     * @var array context menu items. This property will be assigned to {@link CMenu::items}.     */    public $menu = array();    /**     * @var array the breadcrumbs of the current page. The value of this property will     * be assigned to {@link CBreadcrumbs::links}. Please refer to {@link CBreadcrumbs::links}     * for more details on how to specify this property.     */    public $breadcrumbs = array();    public $panel = true;    /*      public function init() {      if ($this->getId() != 'site' && Yii::app()->user->isGuest) {      Yii::app()->user->loginRequired();      }      } */    public function beforeAction($action) {        $actionId = strtolower($this->getAction()->getId());        if ($this->getId() == 'envio' && in_array($actionId, array('sent','savenotification'))) {            return parent::beforeAction($action);        }elseif ($this->getId() == 'infosms' && in_array($actionId, array('savesents'))) {            return parent::beforeAction($action);        } elseif ($this->getId() == 'envio' && in_array($actionId, array('sendsmsbyxml'))) {            header('Content-Type: text/xml; charset=utf-8');            $xmlresponse = simplexml_load_string("<response />");            try {                $session = new LoginForm();                $user=(isset($_GET['user'])&&!empty($_GET['user']))?$_GET['user']:"";                $password=(isset($_GET['password'])&&!empty($_GET['password']))?$_GET['password']:"";                $sessionid=(isset($_GET['sessionid'])&&!empty($_GET['sessionid']))?$_GET['sessionid']:"";                if(!user||!$password||!$sessionid){                    throw new Exception("La autenticaci칩n es inv치lida.");                }                $key=$user."|".Usuario::encrypting($password);                if(sha1($key)==$sessionid){                    $session->username=$user;                    $session->password=$password;                    if ($session->validate() && $session->login())                        return parent::beforeAction($action);                }                throw new Exception("La clave de autenticaci칩n es inv치lida.");            } catch (Exception $ex) {                $xmlresponse->status = "error";                $xmlresponse->message = $ex->getMessage();            }            echo $xmlresponse->asXML();            exit();        } elseif ($this->getId() != 'site' && Yii::app()->user->isGuest) {            Yii::app()->user->loginRequired();        }        return parent::beforeAction($action);    }}